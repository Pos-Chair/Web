<!DOCTYPE html>
<html>

<head>
	<title>Pos-Chair</title>
    <script type='text/javascript' src="https://www.google.com/jsapi"></script>
    <script src="http://cdn.jsdelivr.net/sparkjs/0.5.2/spark.min.js"></script>
    <script src="/js/jquery-1.11.3.min.js"></script>
    <script src='/js/canvasjs.min.js'></script>
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel='stylesheet' type='text/css' />
    <link href="/css/main.css" rel='stylesheet' type='text/css' />
    <link href="/imgs/favicon.ico" rel='shortcut icon' type='image/x-icon' />

    <style>
        
        #logo > img {
            display: block;
            margin: auto;
        }

        #logo > h1 {
            color: #89441d;
            text-align: center;
            font-weight: bold;
        }

        #top {
            width: 100%;
            height: 100vh;
            margin-top: 60px;
        }


        .spark-login-button {
            color: #ff8b25;
            background-color: rgba(0, 0, 0, 0);
            margin: 7% auto;
            display: block;
            font-size: 1em;
            cursor: pointer;
            width: 300px;
        }

        #spark-login-form-button {
            background-color: #ccc;
            font-size; .8em;
            display: block;
            margin: 0;
            width: 268px;i 
            cursor: pointer;
        }

        #spark-login-form-error {
            width: 238px;
        }

        .close-modal {
            color: #fff;
            background-color: #000;
            border-color: #fff;
            border-width: 5px;
            border-style: solid;
            height: 20px !important; 
            width: 20px !important;
            text-indent: 0 !important;
            border-radius: 100%;
            text-align: center;
            text-decoration: none;
        }

        .section {
            text-align: center;
        }

        .text {
            font-size: 1.2em;
            text-align: justify;
            width: 70%;
            margin: 0 auto;
        }

        a {
            color: #89441d;
        }

        a:visited {
            color: #666;
        }

        .section h1 {
            color: #89441d;
        }
        

    </style>

</head>

<body>
    <div id="content">
        <div id='nav'><div><table><tr>
            <td><a id='home' href='#top' class='scroll'>
                <img src="/imgs/full_logo.png" />
                <h3>Pos-Chair</h3>
            </a></td>
            <td><a class='scroll' href='#about'><h4>The Team</h4></a></td>
            <td><a class='scroll' href='#problems'><h4>Posture Problems</h4></a></td>
            <td><a class='scroll' href='#whatis'><h4>What is Pos-Chair?</h4></a></td>
        </tr></table></div></div>

        <div id='top'>
            <div id='logo'>
                <img src="/imgs/full_logo.png" />
                <h1>Pos-Chair</h1>
            </div>
            <div id='spark-login'></div>
        </div>

        <div id='about' class='section'><div>
            <h1>The Team</h1>
            <img src='/imgs/group.jpg' alt='Team Photo' width="600px"/>
                <div class='text'>
            
                    <p>Team info paragraph and things. Very interesting. Yup</p>

                </div>
        </div></div>

        <div id='problems' class='section'><div>
            <h1>Posture Problems</h1>
            <div class='text'>

                <p>Pos-Chair is a pillowcase that turns any chair into a 'smart chair' for correcting back posture.</p>

                <p>
                According to the <a href='http://www.nytimes.com/2011/06/25/health/25consumer.html?_r=0'>NY Times article "Sit Up Straight. Your Back Thanks You,"</a> up to 80 percent 
                of Americans experience back pain at some point in their lives, and each year 15 percent of all adults are treated for such problems as herniated discs, spinal stenosis 
                or lumbar pain... Back pain is notoriously difficult, and expensive, to remedy.
                </p>


            </div>
        </div></div>
        
        <div id='whatis' class='section'><div>
            <h1>What <i>is</i> Pos-Chair?</h1>
            <div class='text'>

	        	<p>
                The Pos-Chair seat cover integrates force sensors to determine a person's weight distribution on the chair and a ping sensor to determine a person's distance from the 
                back of the chair.  Multiple Round Force Sensors strategically placed across the cover interface directly with the Particle Core IoT chip, which communicates with the 
                iOS and Web app via WiFi to provide force data for posture analysis. Depending on distance and force distribution, the user will be able to monitor the quality of 
                his/her posture through the real-time output on our Pos-Chair iOS app. The app was created with the Particle iOS Cloud SDK and communicates with a Particle Internet 
                Button for rapid transfer of sensor information. We have also created a web application that provides a clean presentation of our product, and offers login service 
                allowing users to view graphical real-time data from their Pos-Chair on the web as well as through our app.
                </p>
                
                <p>  
                Our inspiration for Pos-Chair comes from personal experiences and a need we see to decrease back pain associated with sitting long hours in the workforce. With 
                Pos-Chair, people have access to the iOS app or web application which will notify them how to correct their sitting position. With practice, users can identify a 
                correct sitting position, improve their posture longterm and decrease risk of pain and more serious back problems at a relatively low cost. Because Pos-Chair is a cover 
                for a chair it can be used on any chair and is transportable. No sensors are attached to the person. Pos-Chair cover has application to help employees work better 
                because with good back positioning they experience decreased discomfort and pain. As a team comprised of undergraduate and Ph.D students, we have identified application 
                for Pos-Chair in any situation which requires the user to sit whether that be in a class lecture, at a research desk, at work, or at home.
                </p>

                <p>
                When people decide to use Pos-Chair, they are correcting their posture - reducing pain and risks such as herniated discs, spinal stenosis and lumbar pain - and 
                improving their overall health with cutting edge technology at the forefront of ergonomics.
                </p>


            </div>
        </div></div>
        
        <div id="app" class='section'><div>
            <h1 style='margin-bottom: 10px'>Live Feed</h1>
            <div id='chartF' style='float: left;'></div>
            <div id='chartFRL' style="width: 900px; height: 250px; margin: 10px; float: right;"></div>
            <div id='chartBRL' style="width: 900px; height: 250px; margin: 10px; float: right;"></div>
            <div id='chartFB' style='float: left; clear: left'></div>
        </div></div>

        <!--
        <div id="footer">
            <img src="/imgs/full_logo.png" />
        </div>      
        -->

    </div>
</body>

<script>
    var device = null, chartFRLi = null, chartBRL = null;

    sparkLogin(function(data) {

    });

    google.load("visualization", "1", {packages: ['gauge']})
    
    $(document).ready(function() {
        
        $('#app').hide();

        /*
         * Scroll Function - Credits to hanoo.org
         */
        var hashTagActive = '';
        $('.scroll').click(function(event) {
            if(hashTagActive != this.hash) {
                event.preventDefault();

                //set dest
                var dest;
                if($(this.hash).offset().top > $(document).height() - $(window).height()) {
                    dest = $(document).height() - $(window).height();
                } else {
                    dest = $(this.hash).offset().top;
                }

                dest -= 60; //to adapt for header

                //now go there
                $('html, body').animate({scrollTop: dest}, 1000, 'swing');
            }
        });

        $(window).scroll(function() {
            if($(window).scrollTop() == 0) {
                $('#nav').removeClass('hover');
            } else {
                $('#nav').addClass('hover');
            }
        });

        $('#nav h4, .spark-login-button').hover(function() {
            $(this).addClass('nav_hover');
        }, function() {
            $(this).removeClass('nav_hover');
        });
            
        $('.spark-login-button').click(function() {
            $('.close-modal').text('x');
        });

        var dataPoints = [[], [], [], []];

        chartFRL = new CanvasJS.Chart('chartFRL', {
            zoomEnabled: true,
            title: {
                text: "Front Right vs Left Weight Distribution"
            },
            toolTip: {
                shared: true
            },
            legend: {
                verticalAlign: 'top',
                horizontalAlign: 'center',
                fontSize: 14,
                fontWeight: 'bold',
                fontFamily: 'calibri',
                fontColor: 'dimGrey'
            },
            axisX: {
                title: "Time"
            },
            data: [{
                //Series1 (R)
                type: 'line',
                xValueType: "dateTime",
                showInLegend: true,
                name: "Right Side",
                dataPoints: dataPoints[0]
            },
            {
                //Series2 (L)
                type: 'line',
                xValueType: 'dateTime',
                showInLegend: true,
                name: "Left Side",
                dataPoints: dataPoints[1]
            }],
            legend: {
                cursor: 'pointer',
                itemclick: function(e) {
                    if(typeof(e.dataSeries.visible) === 'undefined' || e.dataSeries.visible) {
                        e.dataSeries.visible = false;
                    } else {
                        e.dataSeries.visible = true;
                    }
                    
                    chartFRL.render();
                }
            }
        });

        chartBRL = new CanvasJS.Chart('chartBRL', {
            zoomEnabled: true,
            title: {
                text: "Back Right vs Left Weight Distribution"
            },
            toolTip: {
                shared: true
            },
            legend: {
                verticalAlign: 'top',
                horizontalAlign: 'center',
                fontSize: 14,
                fontWeight: 'bold',
                fontFamily: 'calibri',
                fontColor: 'dimGrey'
            },
            axisX: {
                title: "Time"
            },
            data: [{
                //Series1 (R)
                type: 'line',
                xValueType: "dateTime",
                showInLegend: true,
                name: "Right Side",
                dataPoints: dataPoints[2]
            },
            {
                //Series2 (L)
                type: 'line',
                xValueType: 'dateTime',
                showInLegend: true,
                name: "Left Side",
                dataPoints: dataPoints[3]
            }],
            legend: {
                cursor: 'pointer',
                itemclick: function(e) {
                    if(typeof(e.dataSeries.visible) === 'undefined' || e.dataSeries.visible) {
                        e.dataSeries.visible = false;
                    } else {
                        e.dataSeries.visible = true;
                    }
                    
                    chartBRL.render();
                }
            }
        });

        function push(i, obj) {
            dataPoints[i].push(obj);
        }
        
        var v1 = false, v2 = false, v3 = false, v4 = false;

        spark.on('login', function() {
            var e = jQuery.Event('keydown');
            e.which = 13;
            $('form').trigger(e);
            $('#app').show();
            $('html, body').animate({scrollTop: $('#app').offset().top - 48}, 1000, 'swing');

            setInterval(function() {
                spark.listDevices().then(function(devices) {
                    vars = ['seatR', 'seatL', 'backR', 'backL'];
                    t = Date.now();
                    if(!v1) {
                        v1 = true;
                        devices[0].getVariable(vars[0], function(err, data) {
                            if(!err) {
                                push(0, {
                                    x: t,
                                    y: data.result
                                });
                            }
                            v1 = false;
                        });
                    }
                    if(!v2) {
                        v2 = true;
                        devices[0].getVariable(vars[1], function(err, data) {
                            if(!err) {
                                push(1, {
                                    x: t,
                                    y: data.result
                                });
                            }
                            v2 = false;
                        });
                    }
                    if(!v3) {
                        v3 = true;
                        devices[0].getVariable(vars[2], function(err, data) {
                            if(!err) {
                                push(2, {
                                    x: t,
                                    y: data.result
                                });
                            }
                            v3 = false;
                        });
                    }
                    if(!v4) {
                        v4 = true;
                        devices[0].getVariable(vars[3], function(err, data) {
                            if(!err) {
                                push(3, {
                                    x: t,
                                    y: data.result
                                });
                            }
                            v4 = false;
                        });
                    }
                    chartFRL.render();
                    chartBRL.render();
                    
                    var difRL = Math.abs(dataPoints[0][dataPoints[0].length-1].y - dataPoints[1][dataPoints[1].length-1].y);
                    var ratFB = Math.round(1000 * (5000 - dataPoints[0][dataPoints[0].length-1].y + dataPoints[1][dataPoints[1].length-1].y) /
                                (5000 - dataPoints[2][dataPoints[2].length-1].y + dataPoints[3][dataPoints[3].length-1].y)) / 1000;
                    dataF.setValue(0, 1, difRL);
                    dataFB.setValue(0, 1, ratFB);
                    
                    chartF.draw(dataF, optF);
                    chartFB.draw(dataFB, optFB);
                });
            }, 4000);
        })
        
        var dataF, dataFB;
        var optF, optFB;
        var chartF, chartFB;

        google.setOnLoadCallback(function() {
            setTimeout(drawChartF, 3000);
        });
        function drawChartF() {
            
            dataF = google.visualization.arrayToDataTable([
                ['Label', 'Value'],
                ['LR Offset', 0]
            ]);

            optF = {
                width: 250, height: 250,
                redFrom: 1500, redTo: 2000,
                yellowFrom: 500, yellowTo: 1500,
                greenFrom: 0, greenTo: 500,
                minorTicks: 5, max: 2000
            };

            chartF = new google.visualization.Gauge(document.getElementById('chartF'));

            chartF.draw(dataF, optF);

            drawChartFB();
        }
        
        function drawChartFB() {
         
            dataFB = google.visualization.arrayToDataTable([
                ['Label', 'Value'],
                ['FB Ratio', 15]
            ]);

            optFB = {
                width: 250, height: 250,
                redFrom: 0, redTo: .25,
                yellowFrom: .25, yellowTo: 1,
                greenFrom: 1, greenTo: 5,
                minorTicks: 5, max: 5
            };

            chartFB = new google.visualization.Gauge(document.getElementById('chartFB'));

            chartFB.draw(dataFB, optFB);

            drawChartRF();

        }

    });
</script>
</html>
